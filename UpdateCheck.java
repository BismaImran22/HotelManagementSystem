package Hotel.Management.System;import javax.swing.*;import java.awt.*;import java.awt.event.ActionEvent;import java.awt.event.ActionListener;import java.awt.event.ItemEvent;import java.awt.event.ItemListener;import java.io.*;import java.util.ArrayList;import java.util.List;public class UpdateCheck extends JFrame implements ActionListener {    // --- Standardized Theme Colors ---    private static final Color DARK_BACKGROUND = new Color(3, 45, 48);    private static final Color FIELD_BACKGROUND = new Color(16, 108, 115);    private static final Color TEXT_COLOR = Color.WHITE;    private static final Color ACCENT_COLOR = new Color(255, 215, 0); // Gold accent    private static final Color BUTTON_BG = Color.BLACK;    // ---------------------------------    Choice choiceId;    JTextField tfRoom, tfName, tfCheckInTime, tfDeposit, tfPendingAmount;    JButton check, update, back;    private static final String CUSTOMER_FILE = "customer.csv";    private static final String ROOM_FILE = "rooms.csv";    // Helper class to store all 8 customer fields for safe rewriting    private static class CustomerEntry {        String idType, number, name, gender, country, roomNo, checkinTime, deposit;        CustomerEntry(String idType, String number, String name, String gender, String country, String roomNo, String checkinTime, String deposit) {            this.idType = idType;            this.number = number;            this.name = name;            this.gender = gender;            this.country = country;            this.roomNo = roomNo;            this.checkinTime = checkinTime;            this.deposit = deposit;        }        // Returns the row in CSV format        public String toCsvRow() {            return idType + "," + number + "," + name + "," + gender + "," + country + "," + roomNo + "," + checkinTime + "," + deposit;        }    }    // Store all customer data in memory    private List<CustomerEntry> customerList = new ArrayList<>();    UpdateCheck() {        // --- Panel Setup ---        JPanel panel = new JPanel();        panel.setBounds(5,5,940,490);        panel.setBackground(DARK_BACKGROUND); // Dark Theme        panel.setLayout(null);        add(panel);        // --- Header ---        JLabel label = new JLabel("Check-In Details Update");        label.setBounds(124,11,300,25);        label.setFont(new Font("Tahoma", Font.BOLD, 20));        label.setForeground(ACCENT_COLOR); // Gold Accent        panel.add(label);        // --- Customer ID Label and Choice ---        JLabel UserId = new JLabel("Customer Id");        UserId.setBounds(30,80,150,30);        UserId.setFont(new Font("Tahoma",Font.BOLD,14));        UserId.setForeground(TEXT_COLOR);        panel.add(UserId);        choiceId = new Choice();        choiceId.setBounds(200,85,150,25);        choiceId.setBackground(FIELD_BACKGROUND);        choiceId.setForeground(TEXT_COLOR);        panel.add(choiceId);        // Load IDs and also populate customerList        loadCustomerIDs(choiceId);        // Add ItemListener to auto-load details when selection changes        choiceId.addItemListener(new ItemListener() {            @Override            public void itemStateChanged(ItemEvent e) {                if (e.getStateChange() == ItemEvent.SELECTED) {                    loadCustomerDetails(choiceId.getSelectedItem());                }            }        });        // --- Room Number ---        JLabel labelRoom = new JLabel("Room Number");        labelRoom.setBounds(30,130,150,30);        labelRoom.setFont(new Font("Tahoma",Font.BOLD,14));        labelRoom.setForeground(TEXT_COLOR);        panel.add(labelRoom);        tfRoom = new JTextField();        tfRoom.setBounds(200,135,150,25);        tfRoom.setBackground(FIELD_BACKGROUND);        tfRoom.setForeground(TEXT_COLOR);        tfRoom.setEditable(false);        panel.add(tfRoom);        // --- Name ---        JLabel labelName = new JLabel("Name");        labelName.setBounds(30,180,150,30);        labelName.setFont(new Font("Tahoma",Font.BOLD,14));        labelName.setForeground(TEXT_COLOR);        panel.add(labelName);        tfName = new JTextField();        tfName.setBounds(200,185,150,25);        tfName.setBackground(FIELD_BACKGROUND);        tfName.setForeground(TEXT_COLOR);        panel.add(tfName);        // --- Check-In Time ---        JLabel labelCITime = new JLabel("Check In Time");        labelCITime.setBounds(30,230,150,30);        labelCITime.setFont(new Font("Tahoma",Font.BOLD,14));        labelCITime.setForeground(TEXT_COLOR);        panel.add(labelCITime);        tfCheckInTime = new JTextField();        tfCheckInTime.setBounds(200,235,250,25);        tfCheckInTime.setBackground(FIELD_BACKGROUND);        tfCheckInTime.setForeground(TEXT_COLOR);        panel.add(tfCheckInTime);        // --- Deposit Paid ---        JLabel labelDeposit = new JLabel("Deposit Paid");        labelDeposit.setBounds(30,280,150,30);        labelDeposit.setFont(new Font("Tahoma",Font.BOLD,14));        labelDeposit.setForeground(TEXT_COLOR);        panel.add(labelDeposit);        tfDeposit = new JTextField();        tfDeposit.setBounds(200,285,150,25);        tfDeposit.setBackground(FIELD_BACKGROUND);        tfDeposit.setForeground(TEXT_COLOR);        panel.add(tfDeposit);        // --- Pending Amount ---        JLabel labelPending = new JLabel("Pending Amount");        labelPending.setBounds(30,330,150,30);        labelPending.setFont(new Font("Tahoma",Font.BOLD,14));        labelPending.setForeground(TEXT_COLOR);        panel.add(labelPending);        tfPendingAmount = new JTextField();        tfPendingAmount.setBounds(200,335,150,25);        tfPendingAmount.setBackground(FIELD_BACKGROUND);        tfPendingAmount.setForeground(TEXT_COLOR);        tfPendingAmount.setEditable(false);        panel.add(tfPendingAmount);        // --- Image ---        try {            ImageIcon imageIcon = new ImageIcon(ClassLoader.getSystemResource("icon/check.png"));            Image image = imageIcon.getImage().getScaledInstance(450, 400, Image.SCALE_DEFAULT);            ImageIcon imageIcon1 = new ImageIcon(image);            JLabel imglabel = new JLabel(imageIcon1);            imglabel.setBounds(450, 50, 450, 400);            panel.add(imglabel);        } catch (Exception e) {            System.err.println("Error loading image: icon/check.png");        }        // --- Buttons ---        check = new JButton("CHECK");        check.setBounds(40,400,100,30);        check.setBackground(BUTTON_BG);        check.setForeground(TEXT_COLOR);        check.addActionListener(this);        panel.add(check);        update = new JButton("UPDATE");        update.setBounds(160,400,100,30);        update.setBackground(BUTTON_BG);        update.setForeground(TEXT_COLOR);        update.addActionListener(this);        panel.add(update);        back = new JButton("BACK");        back.setBounds(280,400,100,30);        back.setBackground(BUTTON_BG);        back.setForeground(TEXT_COLOR);        back.addActionListener(this);        panel.add(back);        // Initial load for the first item        if (choiceId.getItemCount() > 0) {            choiceId.select(0);            loadCustomerDetails(choiceId.getSelectedItem());        }        // --- Frame Properties ---        setUndecorated(true);        setLayout(null);        setSize(950,500);        // Center the frame        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();        int x = (screenSize.width - getWidth()) / 2;        int y = (screenSize.height - getHeight()) / 2;        setLocation(x, y);        setVisible(true);    }    // ----------------------------------------------------------------------------------------------------    // --- Data Management Logic ---    // ----------------------------------------------------------------------------------------------------    /**     * Loads customer IDs into the Choice component and populates the in-memory customerList.     * FIX: Removed header skip to handle files without headers.     */    private void loadCustomerIDs(Choice choice) {        customerList.clear();        choice.removeAll();        try (BufferedReader br = new BufferedReader(new FileReader(CUSTOMER_FILE))) {            String line;            // br.readLine(); // <-- REMOVED: Do not skip the header line, as it may be the first data line.            while ((line = br.readLine()) != null) {                String[] data = line.split(",", -1);                // customer.csv fields: ID_Type(0), ID_Number(1), Name(2), Gender(3), Country(4), Room_Number(5), CheckInTime(6), Deposit(7)                if (data.length >= 8) {                    String idNumber = data[1].trim();                    choice.add(idNumber);                    // Populate the list for later retrieval/update                    customerList.add(new CustomerEntry(                            data[0].trim(), data[1].trim(), data[2].trim(), data[3].trim(),                            data[4].trim(), data[5].trim(), data[6].trim(), data[7].trim()                    ));                }            }        } catch (FileNotFoundException e) {            // Specific error for missing file            JOptionPane.showMessageDialog(this, "Error: The file '" + CUSTOMER_FILE + "' was not found. Please ensure it exists in the project root directory.", "File Not Found", JOptionPane.ERROR_MESSAGE);        } catch (IOException e) {            // Generic IO error            JOptionPane.showMessageDialog(this, "Error reading customer IDs from " + CUSTOMER_FILE + ": " + e.getMessage(), "File Error", JOptionPane.ERROR_MESSAGE);        }    }    /**     * Populates JTextFields based on selected customer ID using the in-memory list.     */    private void loadCustomerDetails(String idNumber) {        if (idNumber == null || idNumber.isEmpty()) return;        // Clear previous data        tfRoom.setText("");        tfName.setText("");        tfCheckInTime.setText("");        tfDeposit.setText("");        tfPendingAmount.setText("");        CustomerEntry currentCustomer = null;        for (CustomerEntry entry : customerList) {            if (entry.number.equals(idNumber)) {                currentCustomer = entry;                break;            }        }        if (currentCustomer == null) {            JOptionPane.showMessageDialog(null, "No customer details found for ID: " + idNumber);            return;        }        tfRoom.setText(currentCustomer.roomNo);        tfName.setText(currentCustomer.name);        tfCheckInTime.setText(currentCustomer.checkinTime);        tfDeposit.setText(currentCustomer.deposit);        // Calculate Pending Amount        calculatePendingAmount(currentCustomer.roomNo, currentCustomer.deposit);    }    /**     * Calculates and displays the pending amount (Price - Deposit).     */    private void calculatePendingAmount(String roomNo, String deposit) {        try (BufferedReader br = new BufferedReader(new FileReader(ROOM_FILE))) {            String line;            br.readLine(); // Skip Header (assuming rooms.csv has a header)            while ((line = br.readLine()) != null) {                String[] data = line.split(",", -1);                // rooms.csv fields: Room_Number(0), Availability(1), Clean_Status(2), Price(3), Bed_Type(4)                if (data.length >= 4 && data[0].trim().equals(roomNo)) {                    try {                        int price = Integer.parseInt(data[3].trim()); // Price is field 3                        int paid = Integer.parseInt(deposit.trim());                        int pending = price - paid;                        tfPendingAmount.setText(String.valueOf(pending));                    } catch (NumberFormatException e) {                        tfPendingAmount.setText("Error Price");                        System.err.println("Error parsing price/deposit for room " + roomNo + ".");                    }                    break;                }            }        } catch (Exception ex) {            ex.printStackTrace();            JOptionPane.showMessageDialog(null, "Error reading room data from " + ROOM_FILE + ".");        }    }    /**     * CORE LOGIC: Reads form fields and updates the customer's record in customer.csv.     */    private void updateCustomerDetails() {        String selectedId = choiceId.getSelectedItem();        if (selectedId == null || selectedId.isEmpty()) {            JOptionPane.showMessageDialog(null, "Please select a Customer ID.");            return;        }        String newName = tfName.getText().trim();        String newCheckInTime = tfCheckInTime.getText().trim();        String newDeposit = tfDeposit.getText().trim();        if (newName.isEmpty() || newCheckInTime.isEmpty() || newDeposit.isEmpty()) {            JOptionPane.showMessageDialog(null, "All fields must be filled before updating.");            return;        }        ArrayList<String> fileData = new ArrayList<>();        boolean customerFound = false;        // 1. Read all customer data from the file, modifying the target line        try (BufferedReader br = new BufferedReader(new FileReader(CUSTOMER_FILE))) {            String line;            String header = br.readLine();            if (header != null) {                fileData.add(header); // Preserve the header line            }            while ((line = br.readLine()) != null) {                String[] data = line.split(",", -1);                // customer.csv fields: ID_Type(0), ID_Number(1), Name(2), Gender(3), Country(4), Room_Number(5), CheckInTime(6), Deposit(7)                if (data.length >= 8 && data[1].trim().equals(selectedId)) {                    customerFound = true;                    // Create the updated row                    String updatedLine = data[0] + "," + data[1] + "," + newName + "," + data[3] + "," + data[4] + ","                            + data[5] + "," + newCheckInTime + "," + newDeposit;                    fileData.add(updatedLine);                } else {                    fileData.add(line);                }            }        } catch (IOException ex) {            JOptionPane.showMessageDialog(null, "Error reading file before update.");            return;        }        if (!customerFound) {            JOptionPane.showMessageDialog(null, "Customer record not found in database.");            return;        }        // 2. Write all data back to the file        try (BufferedWriter bw = new BufferedWriter(new FileWriter(CUSTOMER_FILE))) {            for (String s : fileData) {                bw.write(s);                bw.newLine();            }            JOptionPane.showMessageDialog(null, "Check-In Details Updated Successfully!");            setVisible(false);        } catch (IOException ex) {            ex.printStackTrace();            JOptionPane.showMessageDialog(null, "Error writing data back to file.");        }    }    // ----------------------------------------------------------------------------------------------------    // --- Action Listener ---    // ----------------------------------------------------------------------------------------------------    @Override    public void actionPerformed(ActionEvent e) {        if (e.getSource() == check) {            // Re-load details for the currently selected ID            loadCustomerDetails(choiceId.getSelectedItem());        } else if (e.getSource() == update) {            // Calls the core logic to update the customer.csv file            updateCustomerDetails();        } else if (e.getSource() == back) {            setVisible(false);        }    }    public static void main(String[] args) {        new UpdateCheck();    }}