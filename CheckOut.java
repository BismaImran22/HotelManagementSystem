package Hotel.Management.System;import javax.swing.*;import java.awt.*;import java.awt.event.ActionEvent;import java.awt.event.ActionListener;import java.awt.event.ItemEvent;import java.awt.event.ItemListener;import java.io.*;import java.util.Date;import java.util.List;import java.util.ArrayList;public class CheckOut extends JFrame implements ActionListener {    // --- COLOR CONSTANTS FOR LUXURY THEME ---    private static final Color DARK_BACKGROUND = new Color(18, 18, 18); // Deep Black/Charcoal    private static final Color GOLD_ACCENT = new Color(255, 215, 0); // Rich Gold    private static final Color PANEL_BACKGROUND = new Color(30, 30, 30); // Darker charcoal for main panel    private static final Color TEXT_COLOR = Color.WHITE; // White text    private static final Color BUTTON_BACKGROUND = GOLD_ACCENT;    private static final Color BUTTON_FOREGROUND = Color.BLACK;    // ------------------------------------------    Choice CustomerChoice;    JLabel labelRoomnumberValue, labelCheckInTimeValue, labelCheckOutTimeValue;    JButton checkout, back;    private List<CustomerEntry> customerList = new ArrayList<>();    private static final String CUSTOMER_FILE = "customer.csv";    private static final String ROOM_FILE = "room.csv";    CheckOut() {        // --- Panel Setup ---        JPanel panel = new JPanel();        panel.setBounds(5,5,790,390);        panel.setBackground(PANEL_BACKGROUND);        panel.setLayout(null);        add(panel);        // --- Header ---        JLabel label = new JLabel("Check-Out");        label.setBounds(100,20,150,30);        label.setFont(new Font("Serif", Font.BOLD, 26));        label.setForeground(GOLD_ACCENT);        panel.add(label);        // --- Customer ID Label and Choice ---        JLabel UserId = new JLabel("Customer ID / Room No."); // Updated Label        UserId.setBounds(30,80,200,30); // Adjusted bounds        UserId.setFont(new Font("Serif",Font.BOLD,16));        UserId.setForeground(TEXT_COLOR);        panel.add(UserId);        CustomerChoice = new Choice();        CustomerChoice.setBounds(200,80,180,25); // Increased width for the combined text        CustomerChoice.setBackground(DARK_BACKGROUND);        CustomerChoice.setForeground(TEXT_COLOR);        panel.add(CustomerChoice);        // Load Customer Data and populate Choice        loadCustomerData();        // --- Room Number Label and Value ---        JLabel roomNum = new JLabel("Room Number");        roomNum.setBounds(30,130,150,30);        roomNum.setFont(new Font("Serif",Font.BOLD,16));        roomNum.setForeground(TEXT_COLOR);        panel.add(roomNum);        labelRoomnumberValue = new JLabel();        labelRoomnumberValue.setBounds(200,130,150,30);        labelRoomnumberValue.setFont(new Font("Serif",Font.BOLD,16));        labelRoomnumberValue.setForeground(GOLD_ACCENT);        panel.add(labelRoomnumberValue);        // --- Check-In Time Label and Value ---        JLabel checkInTimeLabel = new JLabel("Check-In Time");        checkInTimeLabel.setBounds(30,180,150,30);        checkInTimeLabel.setFont(new Font("Serif",Font.BOLD,16));        checkInTimeLabel.setForeground(TEXT_COLOR);        panel.add(checkInTimeLabel);        labelCheckInTimeValue = new JLabel();        labelCheckInTimeValue.setBounds(200,180,250,30);        labelCheckInTimeValue.setFont(new Font("Serif",Font.BOLD,16));        labelCheckInTimeValue.setForeground(GOLD_ACCENT);        panel.add(labelCheckInTimeValue);        // --- Check-Out Time Label and Value ---        JLabel checkOutTimeLabel = new JLabel("Check-Out Time");        checkOutTimeLabel.setBounds(30,230,150,30);        checkOutTimeLabel.setFont(new Font("Serif",Font.BOLD,16));        checkOutTimeLabel.setForeground(TEXT_COLOR);        panel.add(checkOutTimeLabel);        labelCheckOutTimeValue = new JLabel(""+ new Date()); // Display current system time        labelCheckOutTimeValue.setBounds(200,230,250,30);        labelCheckOutTimeValue.setFont(new Font("Serif",Font.BOLD,16));        labelCheckOutTimeValue.setForeground(GOLD_ACCENT);        panel.add(labelCheckOutTimeValue);        // --- Add ItemListener to update fields on choice change ---        CustomerChoice.addItemListener(new ItemListener() {            @Override            public void itemStateChanged(ItemEvent e) {                updateCustomerFields();            }        });        // Manually trigger update for the first loaded item        if (!customerList.isEmpty()) {            updateCustomerFields();        }        // --- Check-Out Button (Primary Action: Gold/Black) ---        checkout = new JButton("CHECK OUT");        checkout.setBounds(30,320,150,35);        checkout.setBackground(BUTTON_BACKGROUND);        checkout.setForeground(BUTTON_FOREGROUND);        checkout.setFont(new Font("Serif", Font.BOLD, 15));        checkout.addActionListener(this);        panel.add(checkout);        // --- Back Button (Secondary Action: Dark/White) ---        back = new JButton("BACK");        back.setBounds(200,320,150,35);        back.setBackground(DARK_BACKGROUND);        back.setForeground(TEXT_COLOR);        back.setFont(new Font("Serif", Font.BOLD, 15));        back.addActionListener(this);        panel.add(back);        // --- Image ---        ImageIcon i1 = new ImageIcon(ClassLoader.getSystemResource("icon/room.jpg"));        Image i2 = i1.getImage().getScaledInstance(350,300, Image.SCALE_DEFAULT);        ImageIcon imageIcon1 = new ImageIcon(i2);        JLabel imageLabel = new JLabel(imageIcon1);        imageLabel.setBounds(400,20,350,300);        panel.add(imageLabel);        // --- Frame Settings ---        getContentPane().setBackground(DARK_BACKGROUND);        setUndecorated(true);        setLayout(null);        setSize(800,400);        setLocationRelativeTo(null); // Centers the window        setVisible(true);    }    private void loadCustomerData() {        customerList.clear();        CustomerChoice.removeAll();        try (BufferedReader br = new BufferedReader(new FileReader(CUSTOMER_FILE))) {            String line;            while ((line = br.readLine()) != null) {                String[] data = line.split(",", -1);                // ID_Type(0), ID_Number(1), Name(2), Gender(3), Country(4), Room_Number(5), CheckIn_Time(6), Deposit(7)                if (data.length >= 8) {                    CustomerEntry entry = new CustomerEntry(data[0].trim(), data[1].trim(), data[2].trim(), data[3].trim(),                            data[4].trim(), data[5].trim(), data[6].trim(), data[7].trim());                    customerList.add(entry);                    // --- MODIFICATION HERE: Display ID Number and Room Number ---                    // The actual value stored remains just the ID Number (entry.number),                    // but the visible text is combined.                    String visibleText = entry.number + " (" + entry.roomNo + ")";                    CustomerChoice.add(visibleText);                }            }        } catch (IOException e) {            System.err.println("Error reading customer file: " + e.getMessage());        }    }    private void updateCustomerFields() {        // Get the selected item, which looks like "ID_NUMBER (ROOM_NUMBER)"        String selectedVisibleText = CustomerChoice.getSelectedItem();        if (selectedVisibleText == null || selectedVisibleText.isEmpty()) {            labelRoomnumberValue.setText("");            labelCheckInTimeValue.setText("");            return;        }        // --- MODIFICATION HERE: Extract the actual Customer ID Number ---        // Find the index of the first space or parenthesis to isolate the ID.        String selectedID;        int spaceIndex = selectedVisibleText.indexOf(' ');        if (spaceIndex > 0) {            selectedID = selectedVisibleText.substring(0, spaceIndex);        } else {            selectedID = selectedVisibleText; // Fallback if format is unexpected        }        for (CustomerEntry customer : customerList) {            if (customer.number.equals(selectedID)) {                // Fetching Room Number (Field 5)                labelRoomnumberValue.setText(customer.roomNo);                // Fetching Check-In Time (Field 6)                labelCheckInTimeValue.setText(customer.checkinTime);                return;            }        }        labelRoomnumberValue.setText("");        labelCheckInTimeValue.setText("");    }    @Override    public void actionPerformed(ActionEvent e) {        if (e.getSource() == checkout) {            String selectedVisibleText = CustomerChoice.getSelectedItem();            if (selectedVisibleText == null || selectedVisibleText.isEmpty()) {                JOptionPane.showMessageDialog(null, "Please select a Customer ID.");                return;            }            // Extract the actual Customer ID Number            String selectedID;            int spaceIndex = selectedVisibleText.indexOf(' ');            if (spaceIndex > 0) {                selectedID = selectedVisibleText.substring(0, spaceIndex);            } else {                selectedID = selectedVisibleText;            }            // Find the room number for the selected customer            String roomToUpdate = "";            for (CustomerEntry customer : customerList) {                if (customer.number.equals(selectedID)) {                    roomToUpdate = customer.roomNo;                    break;                }            }            try {                // 1. Delete customer record from customer.csv                if (deleteCustomerRecord(CUSTOMER_FILE, selectedID)) {                    // 2. Update room status to 'Available' in room.csv                    if (!roomToUpdate.isEmpty()) {                        updateRoomAvailability(ROOM_FILE, roomToUpdate, "Available");                    }                    JOptionPane.showMessageDialog(null, "Check-out Successful. Room " + roomToUpdate + " is now Available.");                    loadCustomerData();                    updateCustomerFields();                } else {                    JOptionPane.showMessageDialog(null, "Error during check-out: Could not delete customer record or customer not found.");                }            } catch (IOException ex) {                ex.printStackTrace();                JOptionPane.showMessageDialog(null, "A file operation error occurred during check-out.");            }        } else if (e.getSource() == back) {            setVisible(false);        }    }    private boolean deleteCustomerRecord(String fileName, String idNumber) throws IOException {        File inputFile = new File(fileName);        File tempFile = new File(fileName + ".tmp");        boolean recordFound = false;        try (BufferedReader reader = new BufferedReader(new FileReader(inputFile));             PrintWriter writer = new PrintWriter(new BufferedWriter(new FileWriter(tempFile)))) {            String line;            while ((line = reader.readLine()) != null) {                String[] row = line.split(",", -1);                // The customer ID is expected to be in column 1 (ID Number)                if (row.length >= 2 && row[1].trim().equals(idNumber)) {                    recordFound = true;                } else {                    writer.println(line);                }            }        }        if (recordFound) {            if (!inputFile.delete()) throw new IOException("Could not delete original file: " + fileName);            if (!tempFile.renameTo(inputFile)) throw new IOException("Could not rename temp file to original: " + fileName);        } else {            tempFile.delete();        }        return recordFound;    }    private static void updateRoomAvailability(String fileName, String roomNo, String newStatus) throws IOException {        File inputFile = new File(fileName);        File tempFile = new File(fileName + ".tmp");        try (BufferedReader reader = new BufferedReader(new FileReader(inputFile));             PrintWriter writer = new PrintWriter(new BufferedWriter(new FileWriter(tempFile)))) {            String line;            while ((line = reader.readLine()) != null) {                String[] row = line.split(",", -1);                // Room_Number(0), Availability(1)                if (row.length >= 2 && row[0].trim().equals(roomNo)) {                    row[1] = newStatus; // set availability                    writer.println(String.join(",", row));                } else {                    writer.println(line);                }            }        }        if (!inputFile.delete()) throw new IOException("Could not delete original file: " + fileName);        if (!tempFile.renameTo(inputFile)) throw new IOException("Could not rename temp file: " + fileName);    }    private static class CustomerEntry {        String idType, number, name, gender, country, roomNo, checkinTime, deposit;        CustomerEntry(String idType, String number, String name, String gender, String country, String roomNo, String checkinTime, String deposit) {            this.idType = idType;            this.number = number;            this.name = name;            this.gender = gender;            this.country = country;            this.roomNo = roomNo;            this.checkinTime = checkinTime;            this.deposit = deposit;        }    }    public static void main(String[] args) {        new CheckOut();    }}